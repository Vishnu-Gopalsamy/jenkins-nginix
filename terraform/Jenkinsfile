pipeline {
    agent any

    stages {
        stage('Terraform') {
            steps {
                echo 'Deploying...'
                dir('terraform') {
                    sh '''
                        terraform init
                        terraform plan \
                        -var="aws_region=eu-north-1" \
                        -var="ami_id=ami-073130f74f5ffb161" \
                        -var="instance_type=t2.micro" \
                        -var="allowed_ssh_cidr=0.0.0.0/0" \
                        -var="existing_key_pair_name=last"

                        terraform apply -auto-approve \
                        -var="aws_region=eu-north-1" \
                        -var="ami_id=ami-073130f74f5ffb161" \
                        -var="instance_type=t2.micro" \
                        -var="allowed_ssh_cidr=0.0.0.0/0" \
                        -var="existing_key_pair_name=last"
                    '''
                }
            }
        }
    }
}
